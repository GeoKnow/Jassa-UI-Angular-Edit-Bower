/*
 * jassa-ui-angular-edit
 * https://github.com/GeoKnow/Jassa-UI-Angular

 * Version: 0.9.0-SNAPSHOT - 2015-03-04
 * License: BSD
 */
function capitalize(a){return a&&a[0].toUpperCase()+a.slice(1)}angular.module("ui.jassa.edit",["ui.jassa.geometry-input","ui.jassa.rdf-term-input","ui.jassa.rex","ui.jassa.sync"]),angular.module("ui.jassa.geometry-input",[]).directive("geometryInput",["$http","$q",function(a,b){var c=1;return{restrict:"EA",priority:4,require:["^ngModel"],templateUrl:"template/geometry-input/geometry-input.html",replace:!0,scope:{bindModel:"=ngModel",ngModelOptions:"=?",geocodingServices:"=geocodingServices"},controller:["$scope",function(c){c.ngModelOptions=c.ngModelOptions||{},c.geometry="point",c.isLoading=!1,c.getGeocodingInformation=function(b,c){var d="http://nominatim.openstreetmap.org/search/?q="+b+"&format=json&polygon_text=1",e=a({method:"GET",url:d,cache:!0,headers:{Accept:"application/json","Content-Type":"application/json"}});e.success(function(a){angular.isFunction(c)&&c(a,e)}),e.error(function(){alert("AJAX failed!")})};var d=function(a,b){var c=jassa.service.SparqlServiceBuilder.http(a,b,{type:"POST"}).cache().virtFix().paginate(1e3).pageExpand(100).create();return c};c.fetchResultsForRestService=function(b,c){return a({method:"GET",url:b.endpoint+c,cache:!0,headers:{Accept:"application/json","Content-Type":"application/json"}})},c.fetchResultsForSparqlService=function(a,b){var c=d(a.endpoint,a.graph),e=new jassa.sponate.StoreFacade(c,_(a.prefix).defaults(jassa.vocab.InitialContext)),f=a.query.replace(/%SEARCHSTRING%/gi,b);return e.addMap({name:"sparqlService",template:[{id:"?s",label:"?l",wkt:"?g",group:""+a.name}],from:f}),e.sparqlService.getListService().fetchItems(null,10)},c.fetchResults=function(a){var d={restService:[{name:"Nominatim",endpoint:"http://nominatim.openstreetmap.org/search/?format=json&polygon_text=1&q="},{name:"Nokia HERE",endpoint:"http://geocoder.cit.api.here.com/6.2/geocode.json?app_id=DemoAppId01082013GAL&app_code=AJKnXv84fjrb0KIHawS0Tg&additionaldata=IncludeShapeLevel,default&mode=retrieveAddresses&searchtext="}],sparqlService:[{name:"LinkedGeoData (Natural Earth)",endpoint:"http://linkedgeodata.org/vsparql",graph:"http://linkedgeodata.org/ne/",type:"http://linkedgeodata.org/ne/ontology/Country",active:!1,facets:!1,prefix:{ogc:"http://www.opengis.net/ont/geosparql#",geom:"http://geovocab.org/geometry#"},query:'{ Graph <http://linkedgeodata.org/ne/> { ?s a <http://linkedgeodata.org/ne/ontology/Country> ; rdfs:label ?l ; geom:geometry [  ogc:asWKT ?g ]  FILTER regex(?l, "'+a+'", "i")  } }'}]},e={promisesMetaInformation:{restService:[],sparqlService:[]},promises:[]};for(var f in c.geocodingServices){if("restService"===f)for(var g in d.restService){var h=d.restService[g];e.promisesMetaInformation.restService.push({name:h.name,id:e.promises.length}),e.promises.push(c.fetchResultsForRestService(h,a))}if("sparqlService"===f)for(var i in d.sparqlService){var j=d.sparqlService[i];e.promisesMetaInformation.sparqlService.push({name:j.name,id:e.promises.length}),e.promises.push(c.fetchResultsForSparqlService(j,a))}}var k=b.all(e.promises).then(function(a){console.log("promiseCache",e);var b=[];for(var d in a){var f=document.createElement("a");for(var g in a[d].data)if("0"===d&&(f.href=a[d].config.url,a[d].data[g].hasOwnProperty("geotext")&&b.push({firstInGroup:!1,wkt:a[d].data[g].geotext,label:a[d].data[g].display_name,group:c.geocodingServices.restService[d].name||f.hostname})),"1"===d&&(f.href=a[d].config.url,a[d].data[g].View.length>0))for(var h in a[d].data[g].View[0].Result)a[d].data[g].View[0].Result[h].Location.hasOwnProperty("Shape")&&b.push({firstInGroup:!1,wkt:a[d].data[g].View[0].Result[h].Location.Shape.Value,label:a[d].data[g].View[0].Result[h].Location.Address.Label,group:c.geocodingServices.restService[d].name||f.hostname});if("2"===d&&a[d].length>0)for(var i in a[d])b.push({firstInGroup:!1,wkt:a[d][i].val.wkt,label:a[d][i].val.label,group:a[d][i].val.group})}return b=_(b).groupBy("group"),b=_(b).map(function(a){return a[0].firstInGroup=!0,a}),b=_(b).flatten(),b=_(b).value()});return k},c.onSelectGeocode=function(a){console.log("onselect",a),c.bindModel=a.wkt}}],compile:function(){return{pre:function(a,b){function d(){var a="openlayers-map-"+c++;b.find(".map").attr("id",a),l=new OpenLayers.Map(a);var d=new OpenLayers.Layer.WMS("OpenLayers WMS","http://vmap0.tiles.osgeo.org/wms/vmap0?",{layers:"basic"});n=new OpenLayers.Control.Panel({displayClass:"olControlEditingToolbar"});var f={methods:["vertex","edge"],layers:[p]},g=OpenLayers.Util.getParameters(window.location.href).renderer;g=g?[g]:OpenLayers.Layer.Vector.prototype.renderers,p=new OpenLayers.Layer.Vector("Vector Layer",{renderers:g}),l.addLayers([d,p]),l.addControl(new OpenLayers.Control.LayerSwitcher),l.addControl(new OpenLayers.Control.MousePosition),p.events.on({sketchcomplete:e}),o=new OpenLayers.Format.WKT,m={point:new OpenLayers.Control.DrawFeature(p,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint",handlerOptions:f}),line:new OpenLayers.Control.DrawFeature(p,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath",handlerOptions:f}),polygon:new OpenLayers.Control.DrawFeature(p,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:f}),box:new OpenLayers.Control.DrawFeature(p,OpenLayers.Handler.RegularPolygon,{displayClass:"olControlDrawFeatureBox",handlerOptions:_.extend({sides:4,irregular:!0},f)}),modify:new OpenLayers.Control.ModifyFeature(p,{snappingOptions:f,onModificationStart:i,onModification:j,onModificationEnd:k})},n.addControls(m.modify),l.addControl(n),n.activateControl(m.modify);for(var h in m)l.addControl(m[h]);l.setCenter(new OpenLayers.LonLat(0,0),4)}function e(b){var c=f(b.feature);a.bindModel=c,a.$apply()}function f(a){var b=o.write(a);return b=b.replace(/,/g,", ")}function g(b){var c,d=b||a.bindModel,e=o.read(d);if(e){e.constructor!=Array&&(e=[e]);for(var f=0;f<e.length;++f)c?c.extend(e[f].geometry.getBounds()):c=e[f].geometry.getBounds();p.addFeatures(e),l.zoomToExtent(c);{e.length>1?"s":""}}else console.log("Bad WKT")}function h(){var b=m[a.geometry];for(var c in m)b=m[c],a.geometry==c?b.activate():b.deactivate()}function i(){m[a.geometry].deactivate()}function j(b){var c=f(b);a.bindModel=c,a.$apply()}function k(){m[a.geometry].activate()}a.searchString="";var l,m,n,o,p;a.$watch(function(){return a.bindModel},function(b){p.destroyFeatures(),a.bindModel=b,null!=a.bindModel&&g()}),a.$watch(function(){return a.geometry},function(){h()}),d();var q=m[a.geometry];q.activate()}}}}}]),angular.module("ui.jassa.rdf-term-input",[]).directive("rdfTermInput",["$parse",function(){var a={iri:"http://iri",plainLiteral:"http://plainLiteral",typedLiteral:"http://typedLiteral"};return{restrict:"EA",priority:0,require:"^ngModel",templateUrl:"template/rdf-term-input/rdf-term-input.html",replace:!0,scope:{bindModel:"=ngModel",ngModelOptions:"=?",logo:"@?",langs:"=?",datatypes:"=?",rightButton:"=?"},controller:["$scope",function(b){b.state=b.$state||{},b.ngModelOptions=b.ngModelOptions||{},this.setRightButton=function(){b.rightButton=!0},b.vocab=a,b.termTypes=[{id:a.iri,displayLabel:"IRI"},{id:a.plainLiteral,displayLabel:"plain"},{id:a.typedLiteral,displayLabel:"typed"}];var c=[{id:"",displayLabel:"(none)"},{id:"en",displayLabel:"en"},{id:"de",displayLabel:"de"},{id:"fr",displayLabel:"fr"},{id:"zh",displayLabel:"zh"},{id:"ja",displayLabel:"ja"}];b.langs=b.langs||c;var d=Object.keys(jassa.vocab.xsd);b.datatypes=d.map(function(a){var b=jassa.vocab.xsd[a].getUri();return{id:b,displayLabel:jassa.util.UriUtils.extractLabel(b)}}),b.addLanguage=function(a){return{id:a,displayLabel:a}},b.addDatatype=function(a){return{id:a,displayLabel:a}}}],compile:function(){return{pre:function(b){b.rightButton=!1,b.setRightButton=function(){b.rightButton=!0};var c=function(){var c,d=b.state,e=d.type;switch(e){case a.iri:c={type:"uri",value:d.value};break;case a.plainLiteral:c={type:"literal",value:d.value,lang:d.lang,datatype:""};break;case a.typedLiteral:c={type:"literal",value:d.value,datatype:d.datatype||jassa.vocab.xsd.xstring.getUri()};break;default:c={type:"uri",value:d.value}}return c},d=function(b){var c=b;null!=c.type&&null==c.value&&(c.value="");var d;try{d=jassa.rdf.NodeFactory.createFromTalisRdfJson(c)}catch(e){}var f;if(d){if(d.isUri())f={type:a.iri,value:d.getUri()};else if(d.isLiteral()){var g=d.getLiteralDatatypeUri(),h=!jassa.util.ObjectUtils.isEmptyString(g);f=h?{type:a.typedLiteral,value:d.getLiteralLexicalForm(),datatype:g}:{type:a.plainLiteral,value:d.getLiteralLexicalForm(),lang:d.getLiteralLanguage()}}}else f={};return f};b.$watch(function(){var a=b.bindModel;return a},function(a){if(a){var c=d(a);b.state=c;for(var e in b.termTypes)if(b.termTypes[e].id===b.state.type){b.termTypes.selected=b.termTypes[e];break}var f=!1;for(var g in b.datatypes)if(b.datatypes[g].id===b.state.datatype){b.datatypes.selected=b.datatypes[g],f=!0;break}if(!f){var h=new jassa.rdf.PrefixMappingImpl,i={id:b.state.datatype,displayLabel:h.shortForm(b.state.datatype)};b.datatypes.push(i),b.datatypes.selected=i}var j=!1;for(var k in b.langs)if(b.langs[k].id===b.state.lang){b.langs.selected=b.langs[k],j=!0;break}if(!j){var l={id:b.state.lang,displayLabel:b.state.lang};b.langs.push(l),b.langs.selected=l}}else;},!0),b.$watch(function(){var a=c();return a},function(a){a&&angular.copy(a,b.bindModel)},!0)}}}}}]);var Coordinate=Jassa.ext.Class.create({initialize:function(a,b,c,d){this.s=a||"",this.p=b||"",this.i=c||0,this.c=d||""},equals:function(a){var b=this.s===a.s&&this.p===a.p&&this.i===a.i&&this.c===a.c;return b},hashCode:function(){return null==this.hash&&(this.hash=jassa.util.ObjectUtils.hashCodeStr(this.s)+3*jassa.util.ObjectUtils.hashCodeStr(this.p)+7*this.i+11*jassa.util.ObjectUtils.hashCodeStr(this.c)),this.hash},toString:function(){var a=this.s+" "+this.p+" "+this.i+" "+this.c;return a}}),parsePrefixStr=function(){regex=/\s*([^:]+)\s*:\s*([^\s]+)\s*/g},parsePrefixes=function(a){var b=a?a instanceof PrefixMappingImpl?a:new PrefixMappingImpl(a):new PrefixMappingImpl;return b},getModelAttribute=function(a){var b=["ngModel","model"],c=Object.keys(a),d=null;return b.some(function(a){var b=c.indexOf(a)>=0;return b&&(d=a),b}),d},createCompileComponent=function(a,b,c,d){return{pre:function(e,f,g,h){var i=g[a],j=c(i),k=j.assign;d||syncAttr(c,e,g,a);var l=h[0],m=h[2],n=l.allocSlot();n.entry={},e.$on("$destroy",function(){n.release()}),e.$watch(function(){var a=m&&m.$pristine;return a},function(a,b){if(a&&a!=b&&k){var c=getValueAt(e.rexContext.json,newCoordinate);k(e,c)}}),e.$watch(function(){var a=createCoordinate(e,b);return a},function(a,b){if(n.entry.key=a,m&&m.$pristine){if(k){var c=getValueAt(e.rexContext.json,a);k(e,c)}}else{var d=getEffectiveValue(e.rexContext,b);if(d){var f={key:a,val:d};setValueAt(l.getOverride(),f.key,f.val)}}},!0),d||e.$watch(function(){var a=n.entry.key,b=getEffectiveValue(e.rexContext,a);return b},function(a){var b=n.entry.key,c={key:b,val:a};null!=a&&setValueAt(l.getOverride(),c.key,c.val),n.entry.value=a,k&&null!=a&&k(e,a)},!0),e.$watch(function(){var a=j(e);return a},function(a){var b=n.entry.key,c={key:b,val:a};n.entry.val=a,null!=a&&setValueAt(l.getOverride(),c.key,c.val)},!0)}}},assembleTalisRdfJson=function(a){var b={},c=a.entries();return c.forEach(function(c){var d=c.key,e=new Coordinate(d.s,d.p,d.i,"deleted"),f=a.get(e);if(!f){var g=c.val,h=b,i=h[d.s]=h[d.s]||{},j=i[d.p]=i[d.p]||[],k=j[d.i]=j[d.i]||{};k[d.c]=g}}),b},processPrefixes=function(a,b){var c={},d=a,e=Object.keys(d);return e.forEach(function(a){var c=d[a],e=Object.keys(c);e.forEach(function(a){var d=c[a];d.forEach(function(a){var c=b;if(c)if("uri"===a.type){var d=a.value;a.value=c.expandPrefix(d)}else if("literal"===a.type&&null!=a.datatype){var e=a.datatype;a.datatype=c.expandPrefix(e)}})})}),c},createCoordinate=function(a,b){var c=a.rexPrefixMapping||new jassa.rdf.PrefixMappingImpl(jassa.vocab.InitialContext);return new Coordinate(c.expandPrefix(a.rexSubject),c.expandPrefix(a.rexPredicate),a.rexObject,b)},talisRdfJsonToEntries=function(a){var b=[],c=a,d=Object.keys(c);return d.forEach(function(a){var d=c[a],e=Object.keys(d);e.forEach(function(c){var e=d[c],f=0;e.forEach(function(d){var e=Object.keys(d);e.forEach(function(e){var g=d[e],h=new Coordinate(a,c,f,e);b.push({key:h,val:g})}),++f})})}),b},getObjectsAt=function(a,b){var c=a[b.s],d=c?c[b.p]:null;return d},getObjectAt=function(a,b){var c=getObjectsAt(a,b),d=c?c[b.i]:null;return d},getOrCreateObjectAt=function(a,b,c){var d=a[b.s]=a[b.s]||{},e=d[b.p]=d[b.p]||[],f=e[b.i]=e[b.i]||c||{};return f},removeObjectAt=function(a,b){var c=a[b.s],d=c?c[b.p]:null;d&&(d.splice(b.i,1),0===d.length&&delete c[b.p])},removeValueAt=function(a,b){var c=a[b.s],d=c?c[b.p]:null,e=d?d[b.i]:null;e&&(delete e[b.c],0===e.length&&(delete d[b.p],0===Object.keys(d).length&&delete c[b.s]))},setValueAt=function(a,b,c){if(null!=c){var d=getOrCreateObjectAt(a,b);d[b.c]=c}},getValueAt=function(a,b){var c=getObjectAt(a,b),d=c?c[b.c]:null;return d},diff=function(a,b){var c=new jassa.util.HashSet;return b.forEach(function(b){var d=a.contains(b);d||c.add(b)}),c},setDiff=function(a,b){var c={added:diff(a,b),removed:diff(b,a)};return c},getEffectiveValue=function(a,b){var c=a.override?getValueAt(a.override,b):null;return null==c&&(c=a.json?getValueAt(a.json,b):null),c},syncAttr=function(a,b,c,d,e,f){var g=c[d],h=a(g),i=function(a){var c=f?f(a):a;b[d]=c};b.$watch(function(){var a=h(b);return a},function(a){i(a)},e);var j=h(b);return i(j),j},setEleAttrDefaultValue=function(a,b,c,d){var e=a.attr(c);if(!e){e=d,a.attr(c,e);var f=b.$normalize(c);b[f]=e}return e};angular.module("ui.jassa.rex",["dddi","ui.select"]),angular.module("ui.jassa.rex").directive("rexContext",["$parse",function(a){return{priority:30,restrict:"A",scope:!0,require:"rexContext",controller:["$scope",function(a){a.rexContext=a.rexContext||{},this.$scope=a,this.getOverride=function(){var b=a.rexContext,c=b?b.override:null;return c},this.nextSlot=0,a.rexChangeSlots={},this.allocSlot=function(){var b=this.nextSlot++,c=""+b,d=a.rexChangeSlots[c]={id:c,release:function(){delete a.rexChangeSlots[c]}};return d},this.getSlots=function(){var b=a.rexChangeSlots,c=Object.keys(b),d=c.map(function(a){var c=b[a];return c});return d},this.getEnforcedGraph=function(){var a=new jassa.rdf.GraphImpl,b=this.getSlots();return b.forEach(function(b){var c=b.triples;c&&a.addAll(c)}),a},this.getReferencedCoordinates=function(){var a=new jassa.util.HashSet,b=this.getSlots();return b.forEach(function(b){var c=b.entry,d=c?c.key:null;null!=d&&a.add(d)}),a}}],compile:function(b,c){return setEleAttrDefaultValue(b,c,"rex-context","rexContext"),{pre:function(b,c,d,e){syncAttr(a,b,d,"rexContext");var f=function(a){a.override=a.override||{},a.remove=a.remove||function(b){var c=getObjectsAt(a.json,b);c&&c.splice(b.i,1),c=getObjectsAt(a.override,b),c&&c.splice(b.i,1)}};b.$watch(function(){return b.rexContext},function(a){f(a)}),f(b.rexContext);var g=function(){var a=b.rexContext,c=a?a.baseGraph:null;return c};b.$watch(function(){var a=g(),b=a?a.hashCode():null;return b},function(){var a=g();b.rexContext.json=a?jassa.io.TalisRdfJsonUtils.triplesToTalisRdfJson(a):{}});var h=function(a){var c=(e.getOverride(),new jassa.util.HashMap);return a.forEach(function(a){var d=getEffectiveValue(b.rexContext,a);c.put(a,d)}),c},i=function(a,b){var c=assembleTalisRdfJson(a);processPrefixes(c,b);var d=jassa.io.TalisRdfJsonUtils.talisRdfJsonToGraph(c);return d},j=function(a,c){var d=i(a,c),f=e.getEnforcedGraph();d.addAll(f),b.rexContext.graph=d,b.rexContext.targetJson=jassa.io.TalisRdfJsonUtils.triplesToTalisRdfJson(d);var g=new jassa.rdf.GraphImpl,h=e.getReferencedCoordinates(),j=b.rexContext.json;h.forEach(function(a){var b=getObjectAt(j,a);if(null!=b){var c=jassa.rdf.NodeFactory.createFromTalisRdfJson(b),d=jassa.rdf.NodeFactory.createUri(a.s),e=jassa.rdf.NodeFactory.createUri(a.p),f=new jassa.rdf.Triple(d,e,c);g.add(f)}}),b.rexContext.srcGraph=g,b.rexContext.diff=setDiff(g,d)},k=function(){var a=b.rexContext.json,c=e.getOverride(),d=talisRdfJsonToEntries(c);d.forEach(function(b){var d=b.key,e=b.val,f=getValueAt(a,d);(f===e||null==e)&&removeValueAt(c,d)})},l=function(a){var b=e.getOverride(),c=talisRdfJsonToEntries(b);c.forEach(function(c){var d=c.key,e=a.contains(d);e||removeValueAt(b,d)})},m=new jassa.util.HashSet;b.$watch(function(){m=e.getReferencedCoordinates();var a=m.hashCode();return a},function(){l(m),k()},!0);var n=new jassa.util.HashMap;b.$watch(function(){n=h(m);var a=n.hashCode();return a},function(){var a=b.rexContext,c=a?a.prefixMapping:null;j(n,c)},!0)}}}}}]),angular.module("ui.jassa.rex").directive("rexDatatype",["$parse",function(a){return{priority:7,restrict:"A",scope:!0,require:["^rexContext","^rexObject","?ngModel"],controller:angular.noop,compile:function(){return createCompileComponent("rexDatatype","datatype",a)}}}]),angular.module("ui.jassa.rex").directive("rexDeleted",["$parse",function(a){return{priority:7,restrict:"A",scope:!0,require:["^rexContext","^rexObject"],controller:angular.noop,compile:function(){return createCompileComponent("rexDeleted","deleted",a)}}}]),angular.module("ui.jassa.rex").directive("rexIri",["$parse","$compile",function(a,b){return{priority:900,restrict:"A",scope:!0,terminal:!0,controller:angular.noop,compile:function(){return{pre:function(a,c,d){var e=c.attr("rex-iri");if(jassa.util.ObjectUtils.isEmptyString(e)){var f=getModelAttribute(d);e=d[f]}if(!e)throw new Error("No model provided and found");c.removeAttr("rex-iri"),c.attr("rex-object",""),c.attr("rex-termtype",'"uri"'),c.attr("rex-value",e),b(c)(a)}}}}}]),angular.module("ui.jassa.rex").directive("rexLang",["$parse",function(a){return{priority:7,restrict:"A",scope:!0,require:["^rexContext","^rexObject","?ngModel"],controller:angular.noop,compile:function(){return createCompileComponent("rexLang","lang",a)}}}]),angular.module("ui.jassa.rex").directive("rexLiteral",["$parse","$compile",function(a,b){return{priority:900,restrict:"A",scope:!0,terminal:!0,controller:angular.noop,compile:function(){return{pre:function(a,c,d){var e=c.attr("rex-literal");if(jassa.util.ObjectUtils.isEmptyString(e)){var f=getModelAttribute(d);e=d[f]}if(!e)throw new Error("No model provided and found");c.removeAttr("rex-literal"),c.attr("rex-object",""),c.attr("rex-termtype",'"literal"'),c.attr("rex-value",e),b(c)(a)}}}}}]),angular.module("ui.jassa.rex").directive("rexLookup",["$parse",function(a){return{priority:26,restrict:"A",scope:!0,require:"^rexContext",controller:angular.noop,compile:function(){return{pre:function(b,c,d){syncAttr(a,b,d,"rexLookup")}}}}}]),angular.module("ui.jassa.rex").directive("rexNavTargets",["$parse","$q","$dddi",function(a,b,c){return{priority:10,restrict:"A",scope:!0,require:["^rexContext","^rexSubject"],controller:angular.noop,compile:function(){return{pre:function(b,d,e,f){var g=f[0],h=g.allocSlot();h.triples=[],b.$on("$destroy",function(){h.release()}),syncAttr(a,b,e,"rexNavPredicate"),syncAttr(a,b,e,"rexNavInverse");var i=d.attr("rex-nav-targets"),j=c(b);j.register(i,["rexSparqlService","rexSubject","rexNavPredicate","?rexNavInverse",function(a,c,d,e){var f=b.rexPrefixMapping||new jassa.rdf.PrefixMappingImpl(jassa.vocab.InitialContext);c=f.expandPrefix(c),d=f.expandPrefix(d);var g=jassa.sparql.VarUtils.s,h=jassa.rdf.NodeFactory.createUri(d),i=jassa.rdf.NodeFactory.createUri(c),j=e?new jassa.rdf.Triple(g,h,i):new jassa.rdf.Triple(i,h,g),k=new jassa.sparql.Concept(new jassa.sparql.ElementGroup([new jassa.sparql.ElementTriplesBlock([j]),new jassa.sparql.ElementFilter(new jassa.sparql.E_IsIri(new jassa.sparql.ExprVar(g)))]),g),l=jassa.sparql.ConceptUtils.createQueryList(k),m=new jassa.service.ListServiceSparqlQuery(a,l,k.getVar()),n=m.fetchItems().then(function(a){var b=a.map(function(a){var b=a.key.getUri();return b});return b});return n}]);var k=function(a){var c=b.rexPrefixMapping||new jassa.rdf.PrefixMappingImpl(jassa.vocab.InitialContext),d=jassa.rdf.NodeFactory.createUri(c.expandPrefix(b.rexSubject)),e=jassa.rdf.NodeFactory.createUri(c.expandPrefix(b.rexNavPredicate)),f=a.map(function(a){var f=jassa.rdf.NodeFactory.createUri(c.expandPrefix(a)),g=b.rexNavInverse?new jassa.rdf.Triple(f,e,d):new jassa.rdf.Triple(d,e,f);return g});h.triples=f};b.$watchCollection(i,function(a){a&&k(a)})}}}}}]),angular.module("ui.jassa.rex").directive("rexObject",["$parse",function(a){return{priority:13,restrict:"A",scope:!0,require:["^rexContext","^rexPredicate"],controller:angular.noop,compile:function(){return{pre:function(b,c,d,e){var f=e[1],g=(e[0],f.rexObjectScopes.length);d.rexObject||(d.rexObject=""+g),f.rexObjectScopes.push(b),syncAttr(a,b,d,"rexObject"),b.$on("$destroy",function(){jassa.util.ArrayUtils.removeItemStrict(f.rexObjectScopes,b)});var h=function(){var a={s:b.rexSubject,p:b.rexPredicate,i:b.rexObject};return a};b.$watch(function(){var a=h();return a},function(a){b.rexRef=a},!0),b.rexRef=h()}}}}}]),angular.module("ui.jassa.rex").directive("rexPredicate",["$parse",function(a){return{priority:17,restrict:"A",scope:!0,controller:["$scope",function(a){this.rexObjectScopes=a.rexObjectScopes=[]}],compile:function(){return{pre:function(b,c,d){syncAttr(a,b,d,"rexPredicate")}}}}}]),angular.module("ui.jassa.rex").directive("rexPrefix",["$parse",function(a){return{priority:19,restrict:"A",scope:!0,require:"rexContext",controller:["$scope",function(a){a.rexPrefix=a.rexPrefix||{}}],compile:function(b,c){return setEleAttrDefaultValue(b,c,"rex-prefix","rexPrefix"),{pre:function(b,c,d){var e=function(a){var c,d=b.$parent.rexPrefix,e=d?d.prefixes:jassa.vocab.InitialContext;c=e?Object.create(e):{};var f=jassa.util.PrefixUtils.parsePrefixDecls(a);return angular.extend(c,f),c};syncAttr(a,b,d,"rexPrefix",!0,e);var f=function(){b.rexPrefixMapping=new jassa.rdf.PrefixMappingImpl(b.rexPrefix),b.rexContext.prefixMapping=b.rexPrefixMapping};b.$watchGroup([function(){return b.rexPrefix},function(){return b.rexContext}],function(){f()},!0),f()}}}}}]),angular.module("ui.jassa.rex").directive("rexSparqlService",["$parse",function(a){return{priority:30,restrict:"A",scope:!0,controller:angular.noop,compile:function(){return{pre:function(b,c,d){syncAttr(a,b,d,"rexSparqlService")}}}}}]),angular.module("ui.jassa.rex").directive("rexSubject",["$parse","$q",function(a,b){return{priority:24,restrict:"A",scope:!0,require:"^rexContext",controller:angular.noop,compile:function(){return{pre:function(c,d,e,f){var g=(syncAttr(a,c,e,"rexSubject"),function(){var a=c.rexSparqlService,d=c.rexLookup,e=c.rexSubject;if(d&&a&&e){var g=c.rexPrefixMapping,h=g?g.expandPrefix(e):e,i=jassa.rdf.NodeFactory.createUri(h),j=jassa.service.ServiceUtils.execDescribeViaSelect(a,[i]);b.when(j).then(function(a){var b=f.$scope.rexContext,c=(b.baseGraph=b.baseGraph||new jassa.rdf.GraphImpl,new jassa.rdf.Triple(i,null,null));b.baseGraph.removeMatch(c),b.baseGraph.addAll(a)})}});c.$watchCollection("[rexSparqlService, rexLookup, rexSubject, rexPrefixMapping]",function(){g()})}}}}}]),angular.module("ui.jassa.rex").directive("rexTerm",["$parse",function(){return{priority:11,restrict:"A",scope:!0,require:["^rexContext","^rexObject"],controller:angular.noop,compile:function(){throw new Error("rex-term is not implemented yet")}}}]),angular.module("ui.jassa.rex").directive("rexTermtype",["$parse",function(a){return{priority:10,restrict:"A",scope:!0,require:["^rexContext","^rexObject","?ngModel"],controller:angular.noop,compile:function(){return createCompileComponent("rexTermtype","type",a)}}}]),angular.module("ui.jassa.rex").directive("rexTypeof",["$parse","$compile",function(a,b){return{priority:1e3,restrict:"A",scope:!0,terminal:!0,controller:angular.noop,compile:function(){return{pre:function(a,c){var d=c.attr("rex-typeof");c.removeAttr("rex-typeof"),c.attr("rex-predicate",'"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"'),c.attr("rex-iri",d),b(c)(a)}}}}}]),angular.module("ui.jassa.rex").directive("rexValue",["$parse",function(a){return{priority:4,restrict:"A",scope:!0,require:["^rexContext","^rexObject","?ngModel"],controller:angular.noop,compile:function(){return createCompileComponent("rexValue","value",a)}}}]);var syncHelper=function(a,b,c,d,e,f,g,h,i){var j=b[e],k=i?d(j):c(j),l=b[f],m=c(l),n=m.assign,o=b[g],p=c(o),q=function(a){return a},r=b[h],s=c(r),t=function(){var b=s(a),c=angular.isUndefined(b)?!0:b;return c},u=function(){var b=t();if(b){var c=k(a),d=p(a)||q,e=d(c);n(a,e)}};a.$watch(function(){var a=t();return a},function(a){a&&u()}),a.$watch(function(){var b=p(a);return b},function(a){a&&u()}),a.$watch(function(){var b=k(a);return b},function(){u()},!0)};angular.module("ui.jassa.sync",[]),angular.module("ui.jassa.sync").directive("syncTemplate",["$parse","$compile",function(a,b){return{priority:1e3,restrict:"A",scope:!0,terminal:!0,controller:function(){},compile:function(){return{pre:function(a,c,d){var e=c.attr("sync-template");if(c.removeAttr("sync-template"),c.attr("sync-source",e),c.attr("sync-source-interpolate",""),null==c.attr("sync-target")){var f=getModelAttribute(d),g=d[f];if(!g)throw new Error("No model provided and found");c.attr("sync-target",g)}null==c.attr("sync-to-target")&&c.attr("sync-to-target",""),b(c)(a)}}}}}]),angular.module("ui.jassa.sync").directive("syncToSource",["$parse","$interpolate",function(a,b){return{priority:390,restrict:"A",controller:function(){},compile:function(){return{pre:function(c,d,e){syncHelper(c,e,a,b,"syncTarget","syncSource","syncToSource","syncToSourceCond",!1)}}}}}]),angular.module("ui.jassa.sync").directive("syncToTarget",["$parse","$interpolate",function(a,b){return{priority:390,restrict:"A",controller:function(){},compile:function(){return{pre:function(c,d,e){var f="syncSourceInterpolate"in e;syncHelper(c,e,a,b,"syncSource","syncTarget","syncToTarget","syncToTargetCond",f)}}}}}]);